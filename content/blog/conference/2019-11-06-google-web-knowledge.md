| 세미나 명 | 웹 개발자들을 위한 잡다한 웹 지식 세미나               |
| ----- | ------------------------------------- |
| 일정    | 2019-11-06 19:00-21:00                |
| 장소    | 구글 스타트업 캠퍼스                           |
| 발표자   | 이동휘 님                                 |
| 주제    | 구글 검색 엔진 이해하기, 구글 크롤러 봇은 JS를 어떻게 처리할까 |


# 기억에 남는 주제들

- 구글 검색 엔진 활용법
- 서치 콘솔, 모바일 친화성 테스트, Lighthouse
- 구글 크롤러 봇 & 검색 결과는 SPA와 같은 JS앱을 어떻게 받아드릴까


# 구글 검색 엔진 활용법

대부분의 내용들은 내가 구글 검색을 활용하며 많이 사용하던 방식이라 익숙하였다. 그럼에도 잘 모르던 방법과 활용법을 배울 수 있었다. 

그 중에서 `link:` 의 기능이 새롭게 다가왔다. 나는 이 기능을 잘 활용 해 본적이 없는데, `link` 를 우리 사이트로 두고, `site` 또한 우리 사이트로 둠으로서 외부 사이트에서 우리 사이트 링크가 포함된 게시물의 개수를 파악할 수 있다. 

또한 강의를 들으면서 들었던 의문이, 만약 어떤 상황에서 `link:` 를 명령어가 아닌 검색의 일부로 사용하고 싶을때는 어떻게 활용해야 하나에 대한 고민이였다. 흔한 케이스는 아니지만, 예를 들어 에러 로그에 `link:` 와 같은 문구가 포함되어 있고 이 문구 전체를 검색하고 싶다면 어떻게 해야 할까? 이 부분은 아직 답을 찾지 못했다. 

# 서치 콘솔, 모바일 친화성 테스트, Light House

[구글 서치 콘솔](https://search.google.com/search-console/about)

[모바일 친화성 테스트](https://search.google.com/test/mobile-friendly?hl=ko)

[Lighthouse](https://developers.google.com/web/tools/lighthouse)

강의에서 더 나은 웹을 만들기 위해서 이 세가지 도구를 추천하였다. 기존에 구글 서치 콘솔은 살펴만 보고 제대로 활용하지 않았는데, 이번 부스트 캠프 프로젝트를 해보면서 세가지 도구 모두를 활용해 보기로 마음을 먹었다.

구글 서치 콘솔은 내가 소유권을 갖는 사이트에 대해 사용이 가능하고, 구글 검색엔진이 내 사이트를 어떻게 인식하는지 파악이 가능하다. 이 외에도 많은 부가 기능을 제공하지만, 결국 더 나은 웹을 만들기 위한 도구인것 같다.

모바일 친화성 테스트 또한 구글 검색엔진이 사이트를 어떻게 인식하는지 파악을 하는것 같다. 그러나 이 경우에 사이트는 내 소유가 아니더라도 url만 입력하면 확인 가능하다. 이 도구는 모바일에 특화되어 있어 모바일 관련 정보를 위주로 제공한다.

마지막으로 lighthouse 도 더 나은 웹을 만들기 위한 도구이다. 이 도구는 오픈소스 프로젝트 로서 신기하게 CI 과정중에 포함하여 분석을 활용할 수 있다.이 도구는 현재 웹에 대한 인사이트를 제공하고, 더 나은 방향을 위한 가이드를 제공한다.


# 구글 크롤러 봇 & 검색 결과는 SPA와 같은 JS앱을 어떻게 받아드릴까

## 구글봇은 계속 진화한다

강의중에 다음과 같은 인상적인 말을 들었다. 

> 구글봇이 변해야지, 사이트가 변해서는 안된다.

이에 대한 설명을 보충하면...

시대가 변하면서 웹에 JS가 무수히 많이 사용되고 있다. 그러면서 검색엔진의 크롤링 봇들이 이해를 하기 어려워졌다. 
이러한 상황에서, 사이트가 구글봇에 맞추기 위해 JS를 포기하면서 맞추는 방법은 좋지않다는 의미이다. 

사이트가 추구하는 방향은 사용자에 최적화 하는것인데 그 도구로서 JS가 사용되었다면, 그 방법이 최적의 방법인것이다. 고객(사용자)를 위한 최적의 방법을 도출하였는데, 구글 봇에 맞추기 위해 이를 포기하는것은 옳지 않다는 뜻으로 받아들였다. 

이러한 문제를 해결하기 위해서 구글 봇도 진화를 거듭하였고, 현재는 우리가 사용하는 크롬 버전과 비슷한 환경에서 크롤링이 가능해졌다. 덕분에 구글봇은 ES6+, new Web APIs, Less polyfill을 제공할 수 있게 되었다. 

이 구글봇에 대한 더 자세한 키워드는 [evergreen Googlebot](https://webmasters.googleblog.com/2019/05/the-new-evergreen-googlebot.html)을 참고하면 될 것 같다. 

## 구글봇과 Lazy loading

결국 최종적으로 구글 봇이 바라보는 방향은 일반적인 사용자가 바라보는 화면의 결과 그대로를 원하는 것 같다. 이를 위해서 충분한 시간을 (timeout을 정해두는 것 같다) 두고, JS파일들을 실행하며 화면에 적절한 결과물이 보여지기를 기다린다. 

여기서 조심해야 할 부분은, 일반적으로 많이 사용되었던 사용자 인터렉션을 필요로 하는 액션들(hover, click 등)을 통한 추가 정보 로딩은 여전히 해석이 어렵다는 점이다. 특히 Lazy loading과 같은 기법들을 많이 사용하면서 사용자 인터렉션의 결과로 정보를 얻어오곤 하는데, 이를 위한 다양한 표준 방법들이 등장하고 있다. 

그 예로 두가지 정도가 기억난다. 

1. web을 위한 native image lazy-loading
2. Intersection Observer

### web을 위한 native image lazy-loading

첫번째 native lazy-loading 방법은 Chrome 75 부터 제공되는 기능이다. [자세한 설명](https://addyosmani.com/blog/lazy-loading/)

다음과 같이 작성하면, 브라우저에서 기본적으로 lazy loading을 제공해 주며 기존에 사용하던 scroll의 위치에 따른 이벤트 등록 등이 필요없게 된다. 또한 기존의 이벤트 방식에 비해 구글 봇이 이해를 할 수 있음이 중요한 부분인 것 같다. 

```js
// 예시 
<img src="celebration.jpg" loading="lazy" alt="..." />
<iframe src="video-player.html" loading="lazy"></iframe>
```

### Intersection Observer (이하 IO)

이 방법은 매우 유용하고, 자주 사용될 수 있으므로 다른 포스트로 분리하겠다. [자세한 설명](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)

최대한 요약하면, 기존 이벤트 방식과 다르게 메인 스레드를 점유하지 않고, 구글 봇이 이해 가능하다. 

여기서 내가 들었던 의문은, 어찌 되었든 IO또한 적합한 상황이 되어야 액션이 이루어질텐데, 구글봇은 그 적합한 상황을 어떻게 만드나에 대한 의문이였다. 내가 생각할 수 있는 두가지 상황은, 1. viewport를 아주 크게 잡아서 모든 IO가 반응하도록 한다 2. 실제 스크롤을 해서 해당 IO에 접근하여 반응하도록 한다. 

그러나, 두번째 방법은 기존의 이벤트 방식(스크롤을 통한)에서 해결이 어려웠던 부분인데 IO라고 해서 특별히 무언가 다른 수가 있을 것 같지 않았다. 즉, 이 가정을 위해서는 구글봇이 실제 스크롤을 내리는 작업을 해야 할 것 같았다. 

이에 대한 발표자님의 답변은, 구글봇은 그 화면은 매우 크게 잡는다고 언급해 주셨다. 즉, viewport를 매우 크게 잡음으로서 IO가 반응하도록 하는 방향을 따르는것 같다. 

## 구글봇과 SPA

그러면 현재의 구글봇은 많이 사용되는 SPA형태의 앱을 어떻게 바라볼까? 

> 구글봇은 많이 진화하여 일반 사용자가 JS를 통해 완성되는 결과물과 흡사한 결과물을 볼 수 있게 되었다. 

과거 SPA를 검색엔진에 노출하기 위해서는 SSR, Hydrate+SSR, Pre-rendering, Dynamic Rendering 등이 사용되곤 했다. 이들이 모두 해결하고자 하였던 문제는, 구글봇이 검색엔진에 사용될 정보를 수집하는 과정에서 일반적인 HTML과 같은 문서만 수집하기 때문에 SPA와 같이 JS 실행을 통하여 동적으로 문서를 생성하는 SPA의 경우는 검색엔진 노출이 잘 안이루어 진다는 점이였다.

그러나, 위에 언급하였듯이 이제 구글봇은 발전을 통하여 JS파일을 실행하기 때문에 구글 검색엔진만을 위해서라면 크게 걱정을 안해도 될것 같다. 감사하게도 우리는 사용자(고객)에게 최고의 서비스를 제공하기 위한 고민에만 집중하면 될것 같다. (크게 고민 안해도 되지만, 그럼에도 노출하고자 하는 정보의 제공 과정은 염두에 두며 개발을 해야 한다.)

# 느낀점 요약

나는 SEO를 생각하면 우리(개발자)가 구글과 구글봇의 방식에 맞춰야 한다는 생각을 갖고 있었다. 그러나 우리가 해야 할 일은, 구글봇에 적합한 무언가를 만드는게 아니라 결국 사용자가 사용하기 좋은 서비스를 만드는 것에 목표를 두어야 함을 알게 되었다. 즉, 더 나은 웹을 만들기 위한 고민이 결과적으로 구글 봇의 방향과도 일치하는 것 같다. 

또, 지금 진행하고자 하는 프로젝트에 lighthouse를 접목하여 더 나은 웹을 만들어 보려 한다. 

## 기타 

### 언급된 추가 정보들

- [모질라 웹기술블로그](http://hacks.mozilla.or.kr/)
- [Headless Chrome](https://developers.google.com/web/updates/2017/04/headless-chrome)
- [schema org](http://schema.org/)


### 세부 주제
(1) 알아두면 쓸모있을 수도 있는(?!) 잡다하고 자잘한 웹 지식 (30분 강의, 20분 질의응답)
웹 개발자, 웹마스터, 웹 마케터 등 웹으로 밥 먹고 사는 사람들이 한번쯤 들어보거나 생각해봤던 자잘한 궁금증을 풀어보는 시간!
- 고급 Google 검색 기법
- Google 봇의 눈으로 테스트하기
- DNS lookup 테스트 해보기 
- robots.txt 파헤치기 
- 사이트맵 알아보기

(2) Google 검색과 자바스크립트 사이트 (30분 강의, 20분 질의응답)
요즘 자바스크립트가 들어가지 않는 사이트가 없죠? React, Vue.js, Angular, AMP, 날이 갈수록 복잡해지는 자바스크립트 사이트, Google 검색은 자바스크립트로 중무장한 사이트를 제대로 이해할 수 있을까요? 이 세션에서는 Google I/O의 발표 내용을 바탕으로 Google이 동적인 페이지를 어떻게 다루는지 알아봅니다.